var defaultLabelTxt="[click to add description]";var editMode=false;function initAbstractEdit(){elemAbstract=$("textareaAbstract");if(!elemAbstract){return}elemAbstract.onclick=function(){if(!editMode){var a=escapeNewlines(elemAbstract.innerHTML);elemAbstract.innerHTML='<textarea name="textarea" id="'+elemAbstract.id+'_edit" onclick="javascript:showAbstractSaveCancelBox();return true;" onblur="abstractEditBlur();">'+a+"</textarea>";editMode=true;elemAbstract.firstChild.focus();showAbstractSaveCancelBox()}};if(elemAbstract.innerHTML==""){elemAbstract.setStyle({height:"300px"})}else{elemAbstract.innerHTML=unescapeNewlines(elemAbstract.innerHTML);elemAbstract.setStyle({height:"auto"})}elemAbstract.setStyle({cursor:"pointer"});elemAbstract.title="Click to edit"}function abstractEditBlur(){if($("textareaAbstract_edit").value!=""&&$("textareaAbstract_edit").value!=undefined){$("textareaAbstract").setStyle({height:"auto"});$("textareaAbstract").innerHTML=unescapeNewlines($("textareaAbstract_edit").value)}else{$("textareaAbstract").innerHTML="";elemAbstract.setStyle({height:"300px"})}editMode=false;return false}function unescapeNewlines(a){a=a.replace(/</gi,"&lt;");a=a.replace(/>/gi,"&gt;");a=a.replace(/[\n\r\s]+/gi," ");return a}function escapeNewlines(a){a=a.replace(/<\/?p\/?>/gi,"");return a}function onConfirmCitationDetails(){updateObjFields("citation_verified",$("confirmCitationDetails").checked);citationVerified=$("confirmCitationDetails").checked.toString();checkUncheckProgress($("confirmCitationDetails").checked,"pbCitationDetails")}function onAbstractProvided(a){updateObjFields("abstract_provided",a);abstractProvided=a.toString();checkUncheckProgress(a,"pbAbstractProvided")}function onDissertationUploaded(a){updateObjFields("dissertation_uploaded",a);dissertationUploaded=a.toString();checkUncheckProgress(a,"pbDissertationUploaded")}function onSupplementalFilesUploaded(a){updateObjFields("supplemental_files_uploaded",a);checkUncheckProgress(a,"pbSupplementalFilesUploaded");if(a){$("pbSupplementalFilesUploaded").show();$("pbSupplementalFilesUploaded").addClassName("progressItemChecked")}else{$("pbSupplementalFilesUploaded").hide();$("pbSupplementalFilesUploaded").removeClassName("progressItemChecked")}if(membersLength>0){$("cbSupplementalFiles").checked=true;$("cbSupplementalFiles").disabled=true}}function onPermissionFileUploaded(){copyrightMaterialChecked="true";checkUncheckProgress(true,"pbPermissionFilesUploaded");checkUncheckProgress(true,"pbPermissionsProvided");$("pbPermissionFilesUploaded").show();savePermissionsProvidedOption("true","true","true")}function onPermissionFileDeleted(){var d=window._token;var a=window._pid;var b="/submit/"+a+".json";$("uploadPermissionFiles").hide();copyrightMaterialChecked="false";checkUncheckProgress(false,"pbPermissionFilesUploaded");checkUncheckProgress(false,"pbPermissionsProvided");$("pbPermissionFilesUploaded").hide();$("selectPermissionsOptions").options[0].selected=true;var c=new Hash();c.set("authenticity_token",d);c.set("etd[permissions_provided]","");c.set("etd[containscopyright]","");c.set("etd[permission_files_uploaded]",false);var e=new Ajax.Request(b,{method:"put",parameters:c,onSuccess:function(){}})}function checkUncheckProgress(a,b){if(a){$(b).setStyle({backgroundImage:"url(/images/chkbox_checked.png)"});$(b).show()}else{$(b).setStyle({backgroundImage:"url(/images/chkbox_empty.png)"})}if(citationVerified=="true"&&abstractProvided=="true"&&dissertationUploaded=="true"&&rightsSelected=="true"&&ccLicenseSelected=="true"&&copyrightMaterialChecked=="true"){$("submitToRegistrar").enable()}else{$("submitToRegistrar").disable()}}function checkUncheckRightsSelected(){if(rightsSelected=="true"&&ccLicenseSelected=="true"){checkUncheckProgress(true,"pbRightsSelected")}else{checkUncheckProgress(false,"pbRightsSelected")}}function updateObjFields(f,e){var d=window._token;var a=window._pid;var b="/submit/"+a+".json";var c=new Hash();c.set("authenticity_token",d);c.set("etd["+f+"]",e);var g=new Ajax.Request(b,{method:"put",parameters:c,onSuccess:function(){}})}function saveAbstract(){var f=window._token;var b=window._pid;var d="/submit/"+b+".json";var e=new Hash();var c="";var a=false;hideAbstractSaveCancelBox();$("savingAbstract").show();txtAbstract=escapeNewlines($("textareaAbstract").innerHTML);e.set("authenticity_token",f);e.set("etd[abstract]",txtAbstract);if(txtAbstract==""||txtAbstract.length<=0){a=true}var g=new Ajax.Request(d,{method:"put",parameters:e,onSuccess:function(){onAbstractProvided(!a);$("savingAbstract").hide()}});if(txtAbstract==""||txtAbstract.length<=0){elemAbstract.setStyle({height:"300px"})}}function toggleSupplementalFilesElements(){if($("cbSupplementalFiles").checked){$("uploadSupplementalFiles").show()}else{$("uploadSupplementalFiles").hide()}}function togglePermissionFilesElements(){if($("selectPermissionsOptions").getValue()=="true"&&$("uploadPermissionFiles")){$("uploadPermissionFiles").show();if(permissionsLength<=0){copyrightMaterialChecked="false";savePermissionsProvidedOption("","","false");checkUncheckProgress(false,"pbPermissionsProvided");checkUncheckProgress(false,"pbPermissionFilesUploaded");$("pbPermissionFilesUploaded").hide()}}else{if($("selectPermissionsOptions").getValue()=="false"){if(permissionsLength>0){alert("Please remove uploaded permissions file(s) before selecting this option");$("selectPermissionsOptions").options[1].selected=true;return false}else{$("uploadPermissionFiles").hide();copyrightMaterialChecked="true";savePermissionsProvidedOption("true","false","false");checkUncheckProgress(true,"pbPermissionsProvided")}}else{if(permissionsLength>0){alert("Please remove uploaded permissions file(s) before selecting this option");$("selectPermissionsOptions").options[1].selected=true;return false}else{$("uploadPermissionFiles").hide();copyrightMaterialChecked="false";checkUncheckProgress(false,"pbPermissionsProvided");checkUncheckProgress(false,"pbPermissionFilesUploaded");$("pbPermissionFilesUploaded").hide();savePermissionsProvidedOption("","","false")}}}}function toggleSelectOptions(b,a){$(a).disabled=!$(b).checked}function showAbstractSaveCancelBox(){$("abstractSaveCancelBox").setStyle({left:"auto"})}function hideAbstractSaveCancelBox(){$("abstractSaveCancelBox").setStyle({left:"-999px"})}function showRightsLicensesBox(){$("rightsLicensesBox").show()}function hideRightsLicensesBox(){$("rightsLicensesBox").hide()}function showSupplementalLabelsSaveBox(){$("supplementalLabelsSaveBox").show()}function hideSupplementalLabelsSaveBox(){$("supplementalLabelsSaveBox").hide()}function saveRightsLicensesOptions(){var e=window._token;var a=window._pid;var c="/submit/"+a+".json";var d=new Hash();var b="";d.set("authenticity_token",e);d.set("etd[sulicense]",$("cbLicenseStanford").checked);d.set("etd[cclicense]",$("cbLicenseCC").checked);d.set("etd[containscopyright]",$("cbPermissions").checked);d.set("etd[embargo]",$("selectEmbargo").getValue());d.set("etd[cclicensetype]",$("selectLicenseCC").getValue());d.set("etd[rights_selected]",true);if($("cbEmbargo").checked&&$("selectEmbargo").getValue()==""){b="Publication Delay: Please select a duration or uncheck this option\n"}if($("cbLicenseCC").checked&&$("selectLicenseCC").getValue()==""){b=b+"Creative Commons: Please select a license type or uncheck this option\n"}if(b.length>0){alert(b);return}hideRightsLicensesBox();var f=new Ajax.Request(c,{method:"put",parameters:d,onSuccess:function(){}});rightsSelected="true";checkUncheckProgress(true,"pbRightsSelected")}function saveSupplementalLabels(){}function submitToRegistrar(){if(rightsSelected!="true"){alert("Please read and agree to the Stanford University License");return false}if($("selectPermissionsOptions").getValue()=="true"&&permissionsLength<=0){alert("Please upload permission letter(s) or select a different assertion for copyrighted material");return false}if($("selectPermissionsOptions").getValue()==""){alert("Please assert if your thesis/dissertation includes copyrighted material");return false}var g="Are you sure you want to submit your thesis / dissertation?\n\nThe file you have uploaded will be sent to the designated Final Reader for verification and subsequent submission to the University.\n\n";if(confirm(g)){$("submitToRegistrar").disable();$("submitToRegistrarProcessing").show();disableControls();var e=window._token;var b=window._pid;var c="/submit/"+b+".json";var d=new Hash();d.set("authenticity_token",e);d.set("etd[citation_verified]",citationVerified);d.set("etd[abstract_provided]",abstractProvided);d.set("etd[dissertation_uploaded]",dissertationUploaded);d.set("etd[rights_selected]",rightsSelected);d.set("etd[cc_license_selected]",ccLicenseSelected);d.set("etd[embargo]",$("selectReleaseDelayOptions").getValue());d.set("etd[external_visibility]",$("selectExternalAccessOptions").getValue());d.set("etd[cclicense]",$("selectCCLicenseOptions").getValue());var a=$("selectCCLicenseOptions").options[$("selectCCLicenseOptions").selectedIndex].text;d.set("etd[cclicensetype]",a.replace(/\s*\(Recommended\)/,""));var f=new Ajax.Request(c,{method:"put",parameters:d,onSuccess:function(){var j="/submissions/"+b;var h=new Hash();h.set("authenticity_token",e);var k=new Ajax.Request(j,{method:"post",parameters:h,onSuccess:function(l){window.location="/submit/"+b}})}})}else{return}}function checkIfSubmitted(a){if(a.length>0){disableControls()}}function deletePrimaryFile(b){var e=window._token;var a=window._pid;var c="/submit/"+a+"/parts/"+b;var d=new Hash();d.set("authenticity_token",e);$("primaryDeleteImg").setAttribute("src","/images/processing.gif");var f=new Ajax.Request(c,{method:"delete",parameters:d,onSuccess:function(){$("primaryDelete").hide();$("pdfSize").update();$("pdfDate").update();$("primaryUploadBox").show();$("pdfName").update("[no files selected]");$("primaryDeleteImg").removeAttribute("src");onDissertationUploaded(false)}});return}function deleteFile(o,k,l){var h=k.toString();var g=window._token;var n=window._pid;var a="/submit/"+n+"/parts/"+o;var d=new Hash();d.set("authenticity_token",g);var f=l+"DeleteImg_"+h;var e=l+"Name_"+h;var b=l+"Size_"+h;var q=l+"Type_"+h;var p=l+"Desc_"+h;var j=l+"Date_"+h;var r=l+"UploadBox_"+h;var c=l+"Delete_"+h;$(f).setAttribute("src","/images/processing.gif");var m=new Ajax.Request(a,{method:"delete",parameters:d,onSuccess:function(){$(b).update();$(p).update();$(p).hide();$(j).update();$(e).hide();$(r).show();$(f).setAttribute("src","");$(c).hide();if(l.toString()=="s"){$(q).update();--membersLength;if(parseInt(membersLength)<=0){onSupplementalFilesUploaded(false);$("cbSupplementalFiles").checked=false;$("cbSupplementalFiles").disabled=false;toggleSupplementalFilesElements()}}if(l.toString()=="p"){--permissionsLength;if(parseInt(permissionsLength)<=0){onPermissionFileDeleted()}}}});return}function disableControls(){$("confirmCitationDetails").disable();$("selectPermissionsOptions").disable();$("selectReleaseDelayOptions").disable();$("selectCCLicenseOptions").disable();$("cbLicenseStanford").disable();$("cbSupplementalFiles").disable();$("primaryDeleteLink").hide();for(i=1;i<=10;i++){var b="sDelete_"+i;var a="sTxtLabel_"+i;$(b).hide();if($(a)){$(a).disable()}}for(i=1;i<=10;i++){var b="pDelete_"+i;var a="pTxtLabel_"+i;$(b).hide();if($(a)){$(a).disable()}}}function getFieldValue(pid,fieldname){var token=window._token;var url="/submit/"+pid+"/fields/"+fieldname;var pars=new Hash();var value="";pars.set("authenticity_token",token);var updater=new Ajax.Request(url,{method:"get",parameters:pars,onSuccess:function(response){value=eval(response)}});return value}function onLabelFocus(a){if(a.value==defaultLabelTxt){a.value=""}}function onLabelChange(g,b){label=g.value;if(label==""||label.length==0){g.value=defaultLabelTxt}if(label!=defaultLabelTxt){var f=window._token;var a=window._pid;var d="/submit/"+a+"/parts/"+b+".json";var e=new Hash();var c="";e.set("authenticity_token",f);e.set("part[label]",label);var h=new Ajax.Request(d,{method:"put",parameters:e,onSuccess:function(){}})}}function saveStanfordLicenseOption(){var d=window._token;var a=window._pid;var b="/submit/"+a+".json";var c=new Hash();var f=false;f=$("cbLicenseStanford").checked;$("cbLicenseStanford").setAttribute("defaultChecked",f);rightsSelected=f.toString();c.set("authenticity_token",d);c.set("etd[sulicense]",rightsSelected);c.set("etd[rights_selected]",rightsSelected);if(f){$("assertionLicenseStanford").hide();$("assertionLicenseStanfordAgreed").show()}else{$("assertionLicenseStanford").show();$("assertionLicenseStanfordAgreed").hide()}checkUncheckRightsSelected();var e=new Ajax.Request(b,{method:"put",parameters:c,onSuccess:function(){}});return}function savePermissionsProvidedOption(g,e,h){var d=window._token;var a=window._pid;var b="/submit/"+a+".json";var c=new Hash();c.set("authenticity_token",d);c.set("etd[permissions_provided]",g);c.set("etd[containscopyright]",e);c.set("etd[permission_files_uploaded]",h);var f=new Ajax.Request(b,{method:"put",parameters:c,onSuccess:function(){}});return}function saveReleaseDelayOption(){$("embargoOptionTxt").update($("selectReleaseDelayOptions").getValue());updateObjFields("embargo",$("selectReleaseDelayOptions").getValue())}function saveExternalAccessOption(){$("externalAccessTxt").update($("selectExternalAccessOptions").getValue());updateObjFields("external_visibility",$("selectExternalAccessOptions").getValue())}function saveCCLicenseOption(){var e=window._token;var b=window._pid;var c="/submit/"+b+".json";var d=new Hash();d.set("authenticity_token",e);d.set("etd[cclicense]",$("selectCCLicenseOptions").getValue());var a=$("selectCCLicenseOptions").options[$("selectCCLicenseOptions").selectedIndex].text;if($("selectCCLicenseOptions").getValue()==""){a="";ccLicenseSelected="false"}else{ccLicenseSelected="true"}d.set("etd[cclicensetype]",a.replace(/\s*\(Recommended\)/,""));d.set("etd[cc_license_selected]",ccLicenseSelected);checkUncheckRightsSelected();var f=new Ajax.Request(c,{method:"put",parameters:d,onSuccess:function(){if($("selectCCLicenseOptions").getValue()==""){$("assertionLicenseCC").show();$("assertionLicenseCCSelected").hide()}else{$("assertionLicenseCC").hide();showAcceptedLiceseCCAssertion()}}});return}function showAcceptedLiceseCCAssertion(){var b=$("selectCCLicenseOptions").getValue();var a=$("selectCCLicenseOptions").options[$("selectCCLicenseOptions").selectedIndex].text;if(b=="0"){a=a.replace(/no/,"No");$("ccLicenseTxt").update("<strong>"+a+"</strong> ")}else{a=a.replace(/\(Recommended\)/,"");a=a.replace(/CC/,"Creative Commons");$("ccLicenseTxt").update("A <strong>"+a+"</strong> ")}$("assertionLicenseCCSelected").show()}function printLicenseStanford(){disablePrintLicenseStylesheet(false);window.print()}function disablePrintLicenseStylesheet(a){$$("link").each(function(b){if(b.getAttribute("rel").match(/stylesheet/i)&&b.getAttribute("href").match(/lightbox_print/)&&b.getAttribute("media").match(/print/i)){b.disabled=a}})}function toggleMoreSupplementalFiles(c,a){var b="addMoreSupplementalFiles_"+c.toString();var d="linkAddMoreSupplementalFiles_"+c.toString();if(a){$(b).show();$(d).hide()}else{$(b).hide();$(d).show()}}function toggleMorePermissionFiles(c,a){var b="addMorePermissionFiles_"+c.toString();var d="linkAddMorePermissionFiles_"+c.toString();if(a){$(b).show();$(d).hide()}else{$(b).hide();$(d).show()}};
